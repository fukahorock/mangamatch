<!doctype html><html lang="ja"><meta charset="utf-8">
<title>Login Test</title><meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{font-family:system-ui;padding:24px;background:#f8f9fa}
  .card{background:#fff;border:1px solid #dee2e6;border-radius:12px;padding:16px;max-width:640px;margin:0 auto}
  button{padding:.5rem .8rem;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .ok{color:#0a7a31}.ng{color:#a00} img{width:48px;height:48px;border-radius:50%}
  pre{background:#f1f3f5;padding:12px;border-radius:8px;overflow:auto}
</style>
<div class="card">
  <h1>Discord ログイン テスト</h1>
  <div class="row">
    <button id="btnLogin">① Discordでログイン</button>
    <button id="btnMe">② /api/auth/me</button>
    <button id="btnLogout">③ /api/auth/logout</button>
  </div><hr>
  
  <div id="status">未実行</div>
  <div id="user" style="display:none;align-items:center;gap:12px;margin-top:12px">
    <img id="av"><div><div id="name"></div><small id="uid" class="ok"></small></div>
  </div>
  <h3>レスポンス</h3><pre id="out">{}</pre>
</div>
<script>
const $=id=>document.getElementById(id);
$("btnLogin").onclick=()=>location.href="/api/auth/login";
$("btnMe").onclick=async()=>{
  const r=await fetch("/api/auth/me",{credentials:"include"});
  const j=await r.json().catch(()=>({}));
  $("out").textContent=JSON.stringify(j,null,2);
  if(r.ok&&j.authenticated){$("status").innerHTML="状態: <b class='ok'>ログイン済み</b>";
    $("user").style.display="flex"; $("av").src=j.user.avatar; $("name").textContent=j.user.name; $("uid").textContent=`ID: ${j.user.id}`;
  }else{$("status").innerHTML="状態: <b class='ng'>未ログイン</b>"; $("user").style.display="none";}
};
$("btnLogout").onclick=async()=>{
  const r=await fetch("/api/auth/logout",{method:"POST",credentials:"include"});
  const j=await r.json().catch(()=>({})); $("out").textContent=JSON.stringify(j,null,2);
  $("status").innerHTML="状態: <b class='ng'>未ログイン</b>"; $("user").style.display="none";
};
</script></html>
